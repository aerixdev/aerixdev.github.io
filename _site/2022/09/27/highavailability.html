<!DOCTYPE html>

<html>

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>
    고가용성(High Availabilty) 확보 전략 - 에어릭스 환경시스템사업부 기술블로그
    
  </title>

  <meta name="description" content="고가용성(HA : High Availability)이란?">

  <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

  <script src="https://use.fontawesome.com/releases/v5.15.3/js/all.js" crossorigin="anonymous"></script>

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://localhost:4000/2022/09/27/highavailability.html">
  <link rel="alternate" type="application/rss+xml" title="에어릭스 환경시스템사업부 기술블로그" href="/feed.xml">
</head>


<body>

  <!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href="/">에어릭스 환경시스템사업부 기술블로그</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      Menu
      <i class="fa fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a class="nav-link" href="/">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/about">About</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/posts">TECH NOTE</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/link">Link</a>
        </li>
      </ul>
    </div>
  </div>
</nav>


  <!-- Page Header -->

  <header class="masthead">
    
    <div class="overlay"></div>
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">
          <div class="post-heading">
            <h1>고가용성(High Availabilty) 확보 전략</h1>
            
            <h2 class="subheading">S/W기반 서버 이중화 및 Load Balancing 구현</h2>
            
            <span class="meta">Posted by
              <!--<a href="/author">이상훈</a>-->
              <a href="/about">이상훈</a>
              on September 27, 2022 &middot; <span class="reading-time" title="Estimated read time">
  
   5 mins  read </span>

            </span>
          </div>
        </div>
      </div>
    </div>
  </header>

  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">

        <h3 id="고가용성ha--high-availability이란">고가용성(HA : High Availability)이란?</h3>
<hr />
<p><img src="/img/posts/people.png" alt="이중화장치" /></p>

<p><code class="language-plaintext highlighter-rouge">고가용성</code>이란 단어의 의미를 인터넷에서 찾아보면 “서버와 네트워크 또는 프로그램 등의 정보 시스템이 상당히 오랜 기간 동안 지속적으로 장애 없이
정상적으로 운영 가능하도록 하는 성질”이라고 설명이 되어 있습니다. 즉, 애기치 못한 문제가 발생되더라도 장애 발생시간을 최소화해서 정보 시스템을
운영할 수 있도록 구성하는 것을 의미합니다.</p>

<h3 id="고가용성-확보와-거리가-멀었던-시스템-구성">고가용성 확보와 거리가 멀었던 시스템 구성</h3>
<hr />
<p>에어릭스에 입사하고 제일 놀라웠던 사실은 고객사에 구축된 스마트팩토리 시스템이 모두 단일서버로 구성되어 있다는 점이었습니다. 하나의 서버 안에서 MQTT Broker,Web서버,
Was서버,DB서버까지 여러 컴포넌트가 실행되면서 연동되어 있는 구조였습니다. 그렇기 때문에 하나의 컴포넌트에서 장애가 발생하게 되면 다른 컴포넌트까지 연쇄적으로 영향을 끼칠
수 밖에 없었고, 서버 전체적으로 장애가 확산되었습니다.</p>

<p>더군다나 장애 발생시 임시로 가동될 수 있는 백업 서버도 없었기 때문에 서버 장애는 곧 시스템 운영 중단을 의미했습니다.</p>

<p><img src="/img/posts/people2.png" alt="고객불만" /></p>

<p>결국 서버 장애로 인한 잦은 시스템 운영 중단으로 고객불만은 극에 달했고, 개발팀 직원들은 고객사의 컴플레인과 A/S 요청에 시달릴 수 밖에 없었습니다.</p>

<p>가장 큰 문제는 개발팀의 리더들이 근본적인 해결책은 제시하지 못하고, 대책도 없이 직원들만 반복적으로 무의미한 고객사 A/S 업무에 투입시키고 있었던 것입니다. 이로 인한 회사가
감당해야만 했던 금전적인 손실도 상당했습니다.</p>

<h3 id="고가용성-확보-방안의-고민">고가용성 확보 방안의 고민</h3>
<hr />
<p>시스템을 운영하다보면 여러가지 이유로 장애는 언제든지 발생할 수 있습니다. 고가용성을 확보하기 위해서는 시스템은 항상 장애를 발생시킬 수 있다는 가정을 기반으로 아키텍처를
설계해야 합니다. 하지만 과거에 에어릭스가 구축해놓은 스마트팩토리 시스템들을 보면 장애가 발생했을 경우에 대한 고려가 전혀 없었습니다.</p>

<p>고가용성을 확보하기 위해서는 서버의 이중화는 필수적으로 보였습니다. 그래서 우선은 <code class="language-plaintext highlighter-rouge">Active-Standby</code> 방식으로 서버 이중화를 구성해보기로 했습니다. 
평소에는 <code class="language-plaintext highlighter-rouge">Active</code>서버가 동작하다가 장애가 발생하면 <code class="language-plaintext highlighter-rouge">Standby</code>가 즉시 가동되도록 함으로써 시스템 운영이 중단없이 계속될 수 있기 때문에 이 자체만으로도 
고가용성을 크게 향상 시킬 수 있다고 생각되었기 때문입니다.</p>

<p><img src="/img/posts/active_standby.png" alt="Active-Standby구조" /></p>

<h3 id="오픈소스-keepalived-사용">오픈소스 Keepalived 사용</h3>
<hr />
<p>인프라에 대한 지식이 없었기 때문에 인터넷 검색을 통해서 찾은 정보를 기반으로 스스로 스터디를 하면서 <code class="language-plaintext highlighter-rouge">Active-Standby</code> 방식으로 서버 이중화를 구성해 볼 수 밖에
없었습니다. 서버 이중화를 위해서 값비싼 하드웨어 장비나 S/W 솔루션을 도입할 수 있는 상황은 아니었습니다. 그래서 VRRP(Virtual Router Redundancy Protocol)을 이용하는 대표적인 오픈소스 기반의 고가용성 솔루션인 <strong>Keepalived</strong>를 활용해보기로 했습니다.</p>

<p><strong>Keepalived</strong>는 오픈소스라 비용적인 측면에서 부담이 없었고 이미 많은 사용자들이 사용하고 있기 때문에 성능의 안전성도 검증이 되었습니다. 그리고 사용법에 대한 자료도 
인터넷에서 쉽게 찾을 수가 있었습니다.</p>

<p><strong>Keepalived</strong>의 동작원리를 이해하기 위해서는 먼저 VRRP에 대한 개념을 알아야 합니다.<br />
VRRP는 Active/Standby 두 개의 서버가 각자의 Real IP뿐만 아니라 하나의 가상IP(Virtual IP)를 공유하도록 합니다. 그리고 가상IP의 소유권은 우선순위가
높은 Active서버에게 주어집니다. VRRP는 가상IP의 소유권을 가진 서버의 연결에 문제가 없는지 지속적으로 체크(Health Check)를 하게 됩니다.</p>

<p>만약, 가상IP의 소유권을 가진 서버의 연결에 문제가 생기게 되면 VRRP에 의해서 후순위의 우선순위를 가진 서버로 가상IP의 소유권이 자동으로 이전됩니다. 가상IP의 소유권을 가진 Active서버에
문제가 생겨서 연결이 안되는 상황이 발생하게 된다면 Standby서버로 가상IP의 소유권이 이전되기 때문에 가상IP만 가지고 서버에 접속하는 클라이언트는 정상적으로 서비스를
이용할 수 있는 것입니다.</p>

<p><img src="/img/posts/vrrp.png" alt="VRRP" /></p>

<p>사무실에서 라즈베리파이 2대에 <strong>Keepalived</strong>를 설치해서 <code class="language-plaintext highlighter-rouge">Active-Standby</code> 방식으로 서버 이중화를 구성하고 테스트를 진행했었습니다. 테스트를 해보니 기대했던 것처럼 잘 동작하는 
것을 확인할 수 있었습니다.</p>

<h3 id="keepalived의-한계">Keepalived의 한계</h3>
<hr />
<p>하지만 <strong>Keepalived</strong>를 한계도 분명히 존재했습니다. 네트워크 장애나 서버의 하드웨어에 문제가 발생해서 접속이 안되는 경우에는 Standby 서버로 가상IP가 이전되면서
중단없이 정상적으로 서비스가 지속될 수 있었지만, 서버에서 구동중인 소프트웨어의 프로세스가 중단된 경우에는 네트워크 접속은 정상이기 때문에 <strong>Keepalived</strong>에서는 
장애 발생 유무를 판별할 수 없었습니다.</p>

<p>이런 경우를 대비하여 별도의 프로세스 매니저(예:PM2)를 활용하여 무중단 서비스를 구현할 필요가 있었습니다.</p>

<h3 id="서버의-확장까지-고려">서버의 확장까지 고려</h3>
<hr />
<p>우리 에어릭스의 현실에서는 <strong>Keepalived</strong>와 프로세스 매니저의 조합만으로도 기존 대비 충분히 높은 가용성을 확보할 수 있다고 판단했습니다. 하지만</p>

<h3 id="서버확장-방법">서버확장 방법</h3>
<hr />

<p>어떤 정보 시스템을 구축해서 운영하다보면 사용자나 데이터 처리량의 증가 등과 같은 사유로 서버의 용량과 성능을 더 높은 사양으로 확장하는 것이 
필요해질 수 있습니다. 서버의 확장 방법은 <strong>스케일업(Scale up)</strong>과 <strong>스케일아웃(Scale out)</strong>이라는 개념으로 설명할 수 있습니다.</p>

<ul>
  <li>
    <p>스케일업(Scale up) : 수직적 확산</p>

    <p>스케일업은 서버 자체를 더 높은 사양으로 교체하거나, 기존 서버에서 일부 부품을 교환하거나 추가 장착하는 방법으로 성능을 확장하는 방식입니다. 
  이 방식은 성능 확장에 한계가 존재하며, 성능 증가에 따른 비용의 증가폭이 크다는 단점이 있습니다.</p>
  </li>
  <li>
    <p>스케일아웃(Scale out) : 수평적 확산</p>

    <p>스케일아웃은 기존의 서버와 별도로 서버를 추가하여 성능을 확장하는 방식을 말합니다. 여러대의 서버가 병렬로 동작하며 분산처리를 할 수 있도록
  Load Balancing이 필수적으로 요구됩니다. 이 방식은 성능 확장에 한계가 없이 지속적으로 확장이 가능하며, 비교적 저렴한 비용으로도 성능 확장이
  가능하다는 장점이 있습니다.</p>
  </li>
</ul>



        <hr>

        <script src="https://utteranc.es/client.js"
          repo="aerixdev/aerixdev.github.io"
          issue-term="url"
          theme="github-light"
          crossorigin="anonymous"
          async>
        </script>
        
        <div class="clearfix">

          
          <a class="btn btn-primary float-left" href="/2022/09/26/Newbee.html" data-toggle="tooltip" data-placement="top" title="신입 사원이 돌아본 에어릭스 이야기">&larr; Previous<span class="d-none d-md-inline">
              Post</span></a>
          
          

        </div>

      </div>
    </div>
  </div>


  <!-- Footer -->

<hr>

<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">
        <ul class="list-inline text-center">
          
          <li class="list-inline-item">
            <a href="mailto:aerix_es_dev@aerix.co.kr">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="far fa-envelope fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          
          
          
          <li class="list-inline-item">
            <a href="https://github.com/aerixdev">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-github fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
        </ul>
        <p class="copyright text-muted">Copyright &copy; (주)에어릭스 2022</p>
      </div>
    </div>
  </div>
</footer>


  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="/assets/vendor/startbootstrap-clean-blog/js/scripts.js"></script>

<script src="/assets/scripts.js"></script>




  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-D1WDQQYX0G"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-D1WDQQYX0G');
</script>



</body>

</html>
